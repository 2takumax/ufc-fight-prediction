{% extends "base.html" %}

{% block title %}UFC Fight Analytics - ホーム{% endblock %}

{% block content %}
<div class="hero-section bg-dark text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-4 fw-bold">UFC Fight Analytics</h1>
                <p class="lead">UFCの試合データ、オッズ、統計を分析・可視化</p>
            </div>
            <div class="col-md-4 text-end">
                <p class="mb-1">総イベント数: <strong>{{ total_events }}</strong></p>
                <p class="mb-1">総試合数: <strong>{{ total_fights }}</strong></p>
                <p class="mb-0">最新イベント: <strong>{{ latest_event }}</strong></p>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- サマリーカード -->
    <div class="row mb-5">
        <div class="col-md-3 mb-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <h5 class="card-title">イベント数</h5>
                    <h2 class="text-primary">{{ total_events }}</h2>
                    <p class="text-muted">記録されたイベント</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <h5 class="card-title">試合数</h5>
                    <h2 class="text-success">{{ total_fights }}</h2>
                    <p class="text-muted">分析済み試合</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <h5 class="card-title">ファイター数</h5>
                    <h2 class="text-info">{{ total_fighters }}</h2>
                    <p class="text-muted">登録ファイター</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-4">
            <div class="card text-center h-100">
                <div class="card-body">
                    <h5 class="card-title">オッズ予測精度</h5>
                    <h2 class="text-warning">{{ odds_accuracy }}%</h2>
                    <p class="text-muted">お気に入りの勝率</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 最近のイベント -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="mb-4">最近のイベント</h2>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>日付</th>
                            <th>イベント名</th>
                            <th>場所</th>
                            <th>試合数</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in recent_events %}
                        <tr>
                            <td>{{ event.date }}</td>
                            <td><strong>{{ event.name }}</strong></td>
                            <td>{{ event.location }}</td>
                            <td>{{ event.fight_count }}</td>
                            <td>
                                <a href="event_detail.html?id={{ event.id }}" class="btn btn-sm btn-outline-primary">詳細</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- チャート -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">終了方法の分布</h5>
                </div>
                <div class="card-body">
                    <canvas id="finishMethodChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">階級別試合数</h5>
                </div>
                <div class="card-body">
                    <canvas id="weightClassChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- オッズ分析プレビュー -->
    <div class="row mt-5">
        <div class="col-12">
            <h2 class="mb-4">オッズ分析ハイライト</h2>
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>最大アップセット</h6>
                            <p class="mb-1"><strong>{{ biggest_upset.winner }}</strong> def. {{ biggest_upset.loser }}</p>
                            <small class="text-muted">オッズ: {{ biggest_upset.odds }}</small>
                        </div>
                        <div class="col-md-4">
                            <h6>最も正確な予測</h6>
                            <p class="mb-1"><strong>{{ most_accurate.winner }}</strong> def. {{ most_accurate.loser }}</p>
                            <small class="text-muted">オッズ: {{ most_accurate.odds }}</small>
                        </div>
                        <div class="col-md-4">
                            <h6>平均ブックメーカーマージン</h6>
                            <p class="mb-1"><strong>{{ avg_bookmaker_margin }}%</strong></p>
                            <small class="text-muted">全試合平均</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// チャートデータ
const finishMethodData = {{ finish_method_data | tojson }};
const weightClassData = {{ weight_class_data | tojson }};
</script>
{% endblock %}

{% block scripts %}
<script src="js/charts.js"></script>
{% endblock %}